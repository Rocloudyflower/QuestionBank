<div th:fragment="html" xmlns:th="http://www.w3.org/1999/xhtml">

    <script>
        $(function () {
            let keyword = getUrlParms("keyword")
            let data4Vue = {
                uri:"foresearch",
                questions:[],
                file:null,
                pagination:{},
                user:{email: '',password: ''},
                searchFile: ''
            }

            // VueModel
            let vue = new Vue({
                el:"#workingArea",
                data:data4Vue,
                mounted:function(){

                },
                methods:{
                    textSearch:function(){
                        keyword = $(" input[ name='keyword' ] ").val()
                        let url =  this.uri+"?keyword=" + keyword
                        axios.post(url).then(function(response) {
                            // vue.pagination = response.data
                            vue.questions = response.data
                            if(0 === vue.questions.length){
                                let search_string = keyword
                                window.open("https://www.baidu.com/s?wd=" + search_string)
                            }
                            else{
                                console.log(vue.questions)
                                for(let i = 0; i < vue.questions.length ; i++ ){
                                    console.log(vue.questions[i].id)
                                    var temp_id = vue.questions[i].id
                                    $("#questionItemsTR" + temp_id).addClass('firsttime')
                                    $("#questionItemsTRchoice" + temp_id).empty()
                                    $("#questionItemsTR" + temp_id).hide()
                                }
                            }
                        })


                    },
                    photoSearch:function(event){
                        //    ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶
                        //    formdataæ ¼å¼
                        this.searchFile = event.target.files[0]

                        let url = "search/picture"

                        let formData = new FormData()
                        formData.append("image", this.searchFile)

                        axios.post(url,formData).then(function(response){
                            let keyword_ = response.data
                            let url_ =  "foresearch?keyword=" + keyword_
                            axios.post(url_).then(function(response) {
                                // vue.pagination = response.data
                                vue.questions = response.data
                                if(0 === vue.questions.length){
                                    let search_string = keyword_
                                    window.open("https://www.baidu.com/s?wd=" + search_string)
                                }
                                else{
                                    console.log(vue.questions)
                                    for(let i = 0; i < vue.questions.length ; i++ ){
                                        console.log(vue.questions[i].id)
                                        var temp_id = vue.questions[i].id
                                        $("#questionItemsTR" + temp_id).addClass('firsttime')
                                        $("#questionItemsTRchoice" + temp_id).empty()
                                        $("#questionItemsTR" + temp_id).hide()
                                    }
                                }
                            })
                        })
                    },
                    jump: function(page){
                        jump(page,vue)
                    },
                    jumpByNumber: function(start){
                        jumpByNumber(start,vue)
                    },
                    showQuestionItem:function (question) {
                        let qid = question.id
                        if($("#questionItemsTR" + qid).hasClass('firsttime')){
                            let url = "questions/"+ qid +"/propertyValues"
                            let beans = {}
                            axios.get(url).then(function(response) {
                                beans = response.data
                                console.log(beans)
                                for (let i = 0; i < beans.length ; i++){
                                    let p = "<p>" + beans[i].property.name + " | " + beans[i].value + "</p>"
                                    $("#questionItemsTRchoice" + qid).append(p)
                                }
                                // æŸ¥çœ‹è¯¦æƒ…ï¼Œæœç´¢é‡+1
                                let url_ = "questions/searched/"+ qid
                                axios.post(url_).then(function(response){
                                    console.log(response)
                                })

                            })
                        }
                        $("#questionItemsTR" + qid).removeClass('firsttime').toggle()
                    },
                    addCollection:function (question) {
                        let url = "forecheckLogin"
                        axios.get(url).then(function(response) {
                            if(0 === response.data.code){
                                let qid = question.id
                                let url_ =  "collections?qid=" + qid
                                axios.post(url_).then(function(response) {
                                    let result = response.data
                                    if(0 === result.code){
                                        alert("æ·»åŠ æˆåŠŸ")
                                    }
                                    else {
                                        alert("æ·»åŠ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")
                                    }
                                })
                            }
                            else{
                                $("#loginModal").modal('show')
                            }
                        })
                    },
                    evaluateQuestion:function (question,index) {
                        $('#evaluateDIV'+question.id).toggle()
                        submitEvaluation(question,index)
                    },
                    submitEvaluation:function (question,index) {
                        let score = $("input[name='rate']:checked").val()
                        console.log("score:" + score)
                        let url = "questions/evaluate/" + question.id
                        let formdata = new FormData()
                        formdata.set("score",score)
                        axios.post(url,formdata).then(response => {
                            console.log(response.data)
                            let finalScore = response.data.data
                            $("#submitEvaluation"+question.id).css("display","none")
                            $("#rateDIV"+question.id).css("display","none")
                            let p = `<p>æäº¤æˆåŠŸï¼è¯„åˆ†ï¼š${score} åˆ†</p>`
                            $("#resultscore"+question.id).append(p)
                        //    æŠŠç»¼åˆè¯„åˆ†æ”¹æ‰ï¼
                            vue.questions[index].score = finalScore


                        })
                    }
                }
            })
        })
    </script>

    <div th:replace="include/fore_/modal4login::html"></div>

    <div class="searchArea">
        <img th:src="@{/img/logo.png}" alt="" src="../../../static/img/logo.png">
            <input type="text" class="searchInput" name="keyword">
            <ul class="btn-list">
                <li>
                    <button class="search-btn" @click="textSearch">æœç´¢ğŸ”</button>
                </li>
                <li>

                    <button class="search-photo" >
                        ğŸ“·
                        <input id="searchPic" type="file" @change="photoSearch($event)" name="image"/>
                    </button>
                </li>
            </ul>


<!--        æ”¾å…¥ä¸Šä¼ çš„å›¾ç‰‡-->
<!--        <div></div>-->
        <div id="searchResult">
            <div class="searchResultDiv">
                <div th:replace="include/fore_/questionsBySearch::html"></div>
            </div>
        </div>
    </div>

</div>